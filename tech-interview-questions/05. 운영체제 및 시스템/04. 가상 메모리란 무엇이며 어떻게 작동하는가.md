# 가상 메모리란 무엇이며 어떻게 작동하는가

가상 메모리(Virtual Memory)는 컴퓨터 시스템의 메모리 관리 기법 중 하나로, 물리적 메모리(RAM)의 용량 한계를 극복하고 메모리 사용의 효율성을 높이기 위해 사용됩니다. 이를 통해 실행 중인 프로그램이 실제 물리적 메모리보다 더 큰 메모리 공간을 사용할 수 있게 합니다.

## 가상 메모리의 핵심 개념

1. **가상 주소 공간 (Virtual Address Space):**
   - 각 프로세스는 독립적인 가상 주소 공간을 가지며, 이를 통해 프로세스가 사용할 수 있는 메모리 주소를 정의합니다.
   - 가상 주소 공간은 실제 물리적 메모리가 아닌 논리적인 메모리 공간입니다.

2. **페이지와 프레임:**
   - 가상 메모리는 고정된 크기의 페이지로 나뉩니다. 일반적으로 4KB 또는 8KB 크기를 가집니다.
   - 물리적 메모리는 프레임이라 불리는 동일한 크기의 블록으로 나뉩니다.

3. **페이지 테이블 구조:**
   - 가상 주소를 물리적 주소로 변환하기 위해 사용되는 데이터 구조입니다.
   - 각 프로세스는 자신의 페이지 테이블을 가지며, 가상 페이지 번호와 해당 물리적 프레임 번호 간의 매핑 정보를 저장합니다.

4. **페이지 폴트 메커니즘:**
   - 프로세스가 접근하려는 페이지가 물리적 메모리에 없는 경우 발생하는 인터럽트입니다.
   - 페이지 폴트가 발생하면 운영 체제는 해당 페이지를 디스크에서 물리적 메모리로 로드합니다.

## 가상 메모리의 작동 원리

1. **주소 변환 프로세스:**
   - CPU는 프로그램이 참조하는 가상 주소를 물리적 주소로 변환해야 합니다.
   - MMU(Memory Management Unit)가 이 변환 작업을 수행합니다.
   - MMU는 가상 주소를 페이지 번호와 오프셋으로 나누고, 페이지 테이블을 참조하여 해당 페이지 번호에 대한 물리적 메모리 주소를 찾습니다.

2. **TLB(Translation Lookaside Buffer) 활용:**
   - TLB는 최근에 사용된 페이지 테이블 엔트리를 캐싱하는 하드웨어 캐시입니다.
   - TLB hit가 발생하면 페이지 테이블을 조회하지 않고도 빠르게 물리 주소를 얻을 수 있어 주소 변환 속도를 크게 향상시킵니다.

3. **페이지 폴트 처리 과정:**
   - 프로세스가 참조하는 가상 페이지가 물리적 메모리에 없는 경우 페이지 폴트가 발생합니다.
   - 운영 체제는 디스크에서 해당 페이지를 읽어 물리적 메모리에 로드하고, 페이지 테이블을 업데이트하여 가상 주소와 물리적 주소 간의 매핑을 설정합니다.

4. **스와핑과 페이지 교체:**
   - 물리적 메모리가 부족할 경우, 운영 체제는 사용되지 않는 페이지를 디스크로 내보내고(스왑 아웃) 필요한 페이지를 물리적 메모리에 로드합니다(스왑 인).
   - 페이지 교체 알고리즘(예: LRU, FIFO)을 사용하여 스왑 아웃할 페이지를 선택합니다.

## 가상 메모리의 장점과 단점

### 장점

1. **효율적인 메모리 활용:** 실제로 필요한 부분만 물리적 메모리에 로드하여 메모리 사용을 최적화합니다.
2. **프로세스 격리:** 각 프로세스에 독립적인 가상 주소 공간을 제공하여 보안을 강화합니다.
3. **메모리 보호:** 페이지 단위로 접근 권한을 설정하여 무단 접근을 방지합니다.
4. **큰 프로그램 실행 가능:** 물리적 메모리 크기에 제한받지 않고 대용량 프로그램을 실행할 수 있습니다.

### 단점

1. **성능 오버헤드:** 주소 변환 및 페이지 폴트 처리에 추가적인 시간이 소요됩니다.
2. **메모리 관리 복잡성:** 페이지 테이블 등 추가적인 데이터 구조 관리가 필요합니다.
3. **디스크 I/O 증가:** 빈번한 스와핑은 디스크 접근을 증가시켜 성능 저하를 초래할 수 있습니다.

## 최신 가상 메모리 기술

1. **대용량 페이지(Huge Pages):**
   - 기본 페이지 크기(4KB) 외에 더 큰 페이지 크기(예: 2MB, 1GB)를 지원합니다.
   - TLB 효율성을 높이고 페이지 테이블 크기를 줄여 성능을 개선합니다.

2. **NUMA(Non-Uniform Memory Access) 아키텍처 지원:**
   - 다중 프로세서 시스템에서 메모리 접근 시간을 최적화합니다.
   - 각 프로세서에 가까운 메모리를 우선적으로 할당하여 성능을 향상시킵니다.

## 가상 메모리 사용 예시 (C 코드)

```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int main() {
    // 큰 메모리 블록 할당 (가상 메모리 사용)
    char *large_array = (char *)malloc(1024 * 1024 * 1024); // 1GB
    
    if (large_array == NULL) {
        printf("메모리 할당 실패\n");
        return 1;
    }
    
    // 메모리 접근 (페이지 폴트 발생 가능)
    memset(large_array, 0, 1024 * 1024 * 1024);
    
    printf("1GB 메모리가 성공적으로 할당되고 초기화되었습니다.\n");
    
    // 메모리 해제
    free(large_array);
    
    return 0;
}
```

이 예시에서 1GB의 메모리를 할당하지만, 실제로는 가상 메모리를 사용하여 필요한 페이지만 물리적 메모리에 로드됩니다.

## 결론

가상 메모리는 현대 컴퓨터 시스템에서 메모리 관리의 핵심 기술입니다. 물리적 메모리의 한계를 극복하고 메모리 사용의 효율성을 높이며, 프로세스 격리와 메모리 보호 기능을 제공합니다. 하지만 이러한 이점은 일정 수준의 성능 오버헤드를 동반합니다. 최신 기술과 최적화 기법을 통해 이러한 오버헤드를 최소화하고 가상 메모리의 장점을 극대화하는 것이 현대 운영 체제의 중요한 과제입니다.
